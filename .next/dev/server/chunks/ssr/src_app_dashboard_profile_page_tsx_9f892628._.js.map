{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/shreeshashrestha/Desktop/untitled%20folder/Flower%20Bloosom%20web/src/app/dashboard/profile/page.tsx"],"sourcesContent":["\"use client\";\nimport { useState, useRef, ChangeEvent, useEffect } from \"react\";\n\ninterface ProfileData {\n  name: string;\n  email: string;\n  phone: string;\n  address: string;\n}\n\nexport default function ProfilePage() {\n  const [isEditing, setIsEditing] = useState<boolean>(false);\n  const [profilePhoto, setProfilePhoto] = useState<string | null>(null);\n  const [profile, setProfile] = useState<ProfileData>({\n    name: \"\",\n    email: \"\",\n    phone: \"\",\n    address: \"\",\n  });\n  const [editedProfile, setEditedProfile] = useState<ProfileData>(profile);\n  const [loading, setLoading] = useState<boolean>(true);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  // Fetch user data on component mount\n  useEffect(() => {\n    const fetchUserData = async () => {\n      try {\n        // Get user data from localStorage (set during signup/login)\n        const userData = localStorage.getItem('user');\n        \n        if (userData) {\n          const user = JSON.parse(userData);\n          const userProfile: ProfileData = {\n            name: user.name || user.fullName || \"\",\n            email: user.email || \"\",\n            phone: user.phone || \"\",\n            address: user.address || \"\",\n          };\n          setProfile(userProfile);\n          setEditedProfile(userProfile);\n\n          // Fetch profile image from backend\n          const userId = user.id || user._id;\n          if (userId) {\n            try {\n              const response = await fetch(`http://localhost:8000/api/upload/profile-image/${userId}`);\n              if (response.ok) {\n                const imageData = await response.json();\n                if (imageData.data && imageData.data.imageUrl) {\n                  const fullImageUrl = `http://localhost:8000${imageData.data.imageUrl}`;\n                  setProfilePhoto(fullImageUrl);\n                  localStorage.setItem('profilePhoto', fullImageUrl);\n                }\n              }\n            } catch (error) {\n              console.error(\"Error fetching profile image:\", error);\n            }\n          }\n        }\n        \n      } catch (error) {\n        console.error(\"Error fetching user data:\", error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchUserData();\n  }, []);\n\n  const handlePhotoUpload = async (e: ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      // Show preview immediately\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        const result = reader.result;\n        if (result && typeof result === 'string') {\n          setProfilePhoto(result);\n        }\n      };\n      reader.readAsDataURL(file);\n\n      // Upload to backend\n      try {\n        // Get userId from localStorage\n        const userData = localStorage.getItem('user');\n        if (!userData) {\n          alert('User not logged in');\n          return;\n        }\n        \n        const user = JSON.parse(userData);\n        const userId = user.id || user._id;\n\n        const formData = new FormData();\n        formData.append('image', file);  // Backend expects 'image' field name\n        formData.append('userId', userId);\n        \n        // Send to your Express backend\n        const response = await fetch('http://localhost:8000/api/upload/profile-image', {\n          method: 'POST',\n          body: formData,\n        });\n\n        if (!response.ok) {\n          throw new Error('Failed to upload photo');\n        }\n\n        const data = await response.json();\n        console.log('Photo uploaded successfully:', data);\n        \n        // Save the server URL to localStorage and update state\n        if (data.data && data.data.imageUrl) {\n          const fullImageUrl = `http://localhost:8000${data.data.imageUrl}`;\n          setProfilePhoto(fullImageUrl);\n          localStorage.setItem('profilePhoto', fullImageUrl);\n        }\n        \n        alert('Photo uploaded successfully!');\n        \n      } catch (error) {\n        console.error('Error uploading photo:', error);\n        alert('Failed to upload photo to server');\n      }\n    }\n  };\n\n  const handleDeletePhoto = async () => {\n    try {\n      // Get userId from localStorage\n      const userData = localStorage.getItem('user');\n      if (!userData) {\n        alert('User not logged in');\n        return;\n      }\n      \n      const user = JSON.parse(userData);\n      const userId = user.id || user._id;\n\n      // Delete from your Express backend directly\n      const response = await fetch(`http://localhost:8000/api/upload/profile-image/${userId}`, {\n        method: 'DELETE',\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to delete photo');\n      }\n\n      // Clear local state and storage\n      setProfilePhoto(null);\n      localStorage.removeItem('profilePhoto');\n      if (fileInputRef.current) {\n        fileInputRef.current.value = \"\";\n      }\n      \n      alert('Photo deleted successfully!');\n    } catch (error) {\n      console.error('Error deleting photo:', error);\n      alert('Failed to delete photo from server');\n    }\n  };\n\n  const handleSave = async () => {\n    try {\n      // Save to localStorage\n      const userData = localStorage.getItem('user');\n      if (userData) {\n        const user = JSON.parse(userData);\n        const updatedUser = { ...user, ...editedProfile };\n        localStorage.setItem('user', JSON.stringify(updatedUser));\n      }\n\n      // OR save to API if you have backend\n      // await fetch('/api/user/profile', {\n      //   method: 'PUT',\n      //   headers: { 'Content-Type': 'application/json' },\n      //   body: JSON.stringify(editedProfile)\n      // });\n\n      setProfile(editedProfile);\n      setIsEditing(false);\n      alert(\"Profile updated successfully!\");\n    } catch (error) {\n      console.error(\"Error saving profile:\", error);\n      alert(\"Failed to update profile\");\n    }\n  };\n\n  const handleCancel = () => {\n    setEditedProfile(profile);\n    setIsEditing(false);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center min-h-screen\">\n        <div className=\"text-xl text-gray-600\">Loading profile...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex justify-center pt-12 min-h-screen\">\n      <div className=\"w-full max-w-2xl px-4\">\n        <div className=\"bg-white rounded-xl p-8 border border-pink-100 shadow-lg\">\n          <div className=\"flex justify-between items-center mb-6\">\n            <h2 className=\"text-xl font-bold text-gray-800\">Personal Information</h2>\n            {!isEditing && (\n              <button\n                onClick={() => setIsEditing(true)}\n                className=\"px-6 py-2 border border-pink-300 text-pink-600 rounded-full hover:bg-pink-50 transition\"\n              >\n                ‚úèÔ∏è Edit Profile\n              </button>\n            )}\n          </div>\n\n          {/* Profile Photo Section - Always visible */}\n          <div className=\"mb-6 flex items-center gap-6\">\n            <div className=\"relative flex-shrink-0\">\n              <div className=\"w-24 h-24 rounded-full overflow-hidden border-3 border-pink-200 bg-gray-100 flex items-center justify-center\">\n                {profilePhoto ? (\n                  <img\n                    src={profilePhoto}\n                    alt=\"Profile\"\n                    className=\"w-full h-full object-cover\"\n                  />\n                ) : (\n                  <svg\n                    className=\"w-12 h-12 text-gray-400\"\n                    fill=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path d=\"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z\" />\n                  </svg>\n                )}\n              </div>\n            </div>\n            \n            {/* Upload/Delete buttons - Only show when editing */}\n            {isEditing && (\n              <div className=\"flex gap-3\">\n                <input\n                  type=\"file\"\n                  ref={fileInputRef}\n                  onChange={handlePhotoUpload}\n                  accept=\"image/*\"\n                  className=\"hidden\"\n                  id=\"photo-upload\"\n                />\n                <label\n                  htmlFor=\"photo-upload\"\n                  className=\"px-4 py-2 bg-pink-500 text-white rounded-full hover:bg-pink-600 transition cursor-pointer font-medium text-sm\"\n                >\n                  üì∑ Upload Photo\n                </label>\n                {profilePhoto && (\n                  <button\n                    onClick={handleDeletePhoto}\n                    className=\"px-4 py-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition font-medium text-sm\"\n                  >\n                    üóëÔ∏è Delete Photo\n                  </button>\n                )}\n              </div>\n            )}\n          </div>\n\n          <div className=\"space-y-6\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Full Name\n              </label>\n              {isEditing ? (\n                <input\n                  type=\"text\"\n                  value={editedProfile.name}\n                  onChange={(e) =>\n                    setEditedProfile({ ...editedProfile, name: e.target.value })\n                  }\n                  className=\"w-full px-4 py-2 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-300\"\n                />\n              ) : (\n                <p className=\"text-gray-800 text-lg\">{profile.name}</p>\n              )}\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Email\n              </label>\n              {isEditing ? (\n                <input\n                  type=\"email\"\n                  value={editedProfile.email}\n                  onChange={(e) =>\n                    setEditedProfile({ ...editedProfile, email: e.target.value })\n                  }\n                  className=\"w-full px-4 py-2 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-300\"\n                />\n              ) : (\n                <p className=\"text-gray-800 text-lg\">{profile.email}</p>\n              )}\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Phone Number\n              </label>\n              {isEditing ? (\n                <input\n                  type=\"tel\"\n                  value={editedProfile.phone}\n                  onChange={(e) =>\n                    setEditedProfile({ ...editedProfile, phone: e.target.value })\n                  }\n                  className=\"w-full px-4 py-2 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-300\"\n                />\n              ) : (\n                <p className=\"text-gray-800 text-lg\">{profile.phone}</p>\n              )}\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Address\n              </label>\n              {isEditing ? (\n                <textarea\n                  value={editedProfile.address}\n                  onChange={(e) =>\n                    setEditedProfile({ ...editedProfile, address: e.target.value })\n                  }\n                  rows={2}\n                  className=\"w-full px-4 py-2 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-300 resize-none\"\n                />\n              ) : (\n                <p className=\"text-gray-800 text-lg\">{profile.address}</p>\n              )}\n            </div>\n            {isEditing && (\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  onClick={handleSave}\n                  className=\"flex-1 py-3 px-6 bg-pink-500 text-white rounded-full hover:bg-pink-600 transition font-semibold\"\n                >\n                  Save Changes\n                </button>\n                <button\n                  onClick={handleCancel}\n                  className=\"flex-1 py-3 px-6 border border-pink-300 text-pink-600 rounded-full hover:bg-pink-50 transition font-medium\"\n                >\n                  Cancel\n                </button>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":"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"}}]
}